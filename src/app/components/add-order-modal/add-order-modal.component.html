<div class="modal fade show" 
     [class.d-block]="show" 
     tabindex="-1" 
     role="dialog"
     (click)="onBackdropClick($event)">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-cart-plus me-2"></i>
          Add New Order
        </h5>
        <button type="button" 
                class="btn-close" 
                (click)="closeModal()"
                aria-label="Close">
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <div class="row mb-3">
          <div class="col">
            <p class="text-muted mb-0">
              Add order items by entering barcode, quantity, and MRP for each item.
            </p>
          </div>
        </div>

        <!-- Order Items Table -->
        <div class="table-responsive">
          <table class="table table-borderless">
            <thead class="table-light">
              <tr>
                <th scope="col" style="width: 40%">Barcode</th>
                <th scope="col" style="width: 25%">Quantity</th>
                <th scope="col" style="width: 25%">MRP (â‚¹)</th>
                <th scope="col" style="width: 10%">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of orderItems; let i = index" class="align-middle">
                <!-- Barcode Field -->
                <td>
                  <input 
                    type="text" 
                    class="form-control form-control-sm" 
                    [class.is-invalid]="hasFieldError('barcode', i)"
                    [(ngModel)]="item.barcode"
                    placeholder="Enter barcode"
                    (input)="validateField('barcode', i)"
                    (keyup.enter)="onSubmit()"
                    (keyup.escape)="closeModal()">
                  
                  <div class="invalid-feedback" *ngIf="hasFieldError('barcode', i)">
                    {{ getFieldError('barcode', i) }}
                  </div>
                </td>

                <!-- Quantity Field -->
                <td>
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    [class.is-invalid]="hasFieldError('quantity', i)"
                    [(ngModel)]="item.quantity"
                    min="1"
                    placeholder="Qty"
                    (input)="validateField('quantity', i)"
                    (keyup.enter)="onSubmit()"
                    (keyup.escape)="closeModal()">
                  
                  <div class="invalid-feedback" *ngIf="hasFieldError('quantity', i)">
                    {{ getFieldError('quantity', i) }}
                  </div>
                </td>

                <!-- MRP Field -->
                <td>
                  <input 
                    type="number" 
                    class="form-control form-control-sm" 
                    [class.is-invalid]="hasFieldError('mrp', i)"
                    [(ngModel)]="item.mrp"
                    min="0.01"
                    step="0.01"
                    placeholder="MRP"
                    (input)="validateField('mrp', i)"
                    (keyup.enter)="onSubmit()"
                    (keyup.escape)="closeModal()">
                  
                  <div class="invalid-feedback" *ngIf="hasFieldError('mrp', i)">
                    {{ getFieldError('mrp', i) }}
                  </div>
                </td>

                <!-- Actions -->
                <td class="text-center">
                  <button 
                    type="button" 
                    class="btn btn-outline-danger btn-sm"
                    (click)="removeOrderItem(i)"
                    [disabled]="orderItems.length === 1"
                    title="Remove item">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Add Row Button -->
        <div class="row mt-3">
          <div class="col">
            <button 
              type="button" 
              class="btn btn-outline-primary btn-sm"
              (click)="addOrderItem()">
              <i class="bi bi-plus-circle me-1"></i>
              Add Another Item
            </button>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" 
                class="btn btn-secondary" 
                (click)="closeModal()">
          Cancel
        </button>
        <button type="button" 
                class="btn btn-primary" 
                (click)="onSubmit()"
                [disabled]="!isFormValid()">
          <i class="bi bi-check-circle me-1"></i>
          Create Order
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade show" *ngIf="show"></div> 